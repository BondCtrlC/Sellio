# User Flows

## Overview

มี 2 roles หลัก:
1. **Creator** - ผู้ขาย/Content Creator
2. **Buyer** - ผู้ซื้อ (ไม่ต้องมีบัญชี)

---

## Flow 1: Creator Onboarding

```
┌─────────────────────────────────────────────────────────────────┐
│                     CREATOR ONBOARDING                          │
└─────────────────────────────────────────────────────────────────┘

[Landing Page /]
      │
      ▼
[Click "เริ่มต้นใช้งาน"]
      │
      ▼
[Signup Page /signup]
      │
      ├─ Input: Email
      ├─ Input: Password
      └─ Input: Username (unique)
      │
      ▼
[Submit] ─────────────────────┐
      │                       │
      ▼                       ▼
[Supabase Auth]         [Auto-create creator profile]
      │                       │
      ▼                       │
[Verify Email] ◄──────────────┘
      │
      ▼
[Login] ─────────────────────────────────────────┐
      │                                          │
      ▼                                          ▼
[Redirect to /dashboard/settings]         [Show welcome modal]
      │
      ▼
[Complete Profile]
      ├─ Display Name
      ├─ Bio
      ├─ Avatar
      ├─ PromptPay ID
      └─ Contact Info
      │
      ▼
[Save] → [Publish Store]
      │
      ▼
[Store Live at /u/{username}] ✓
```

### Acceptance Criteria - Onboarding
- [ ] สมัครด้วย email + password ได้
- [ ] Username ต้อง unique, lowercase, ไม่มี space
- [ ] ระบบสร้าง creator profile อัตโนมัติหลัง signup
- [ ] เข้า dashboard ได้หลัง login
- [ ] แก้ไข profile ได้ (display name, bio, avatar)
- [ ] ตั้งค่า PromptPay ได้
- [ ] Publish/Unpublish store ได้

---

## Flow 2: Product Management

```
┌─────────────────────────────────────────────────────────────────┐
│                     PRODUCT MANAGEMENT                          │
└─────────────────────────────────────────────────────────────────┘

[Dashboard /dashboard]
      │
      ▼
[Click "สินค้า" in sidebar]
      │
      ▼
[Products List /dashboard/products]
      │
      ├─ View all products
      ├─ Filter by type
      └─ Quick publish/unpublish
      │
      ▼
[Click "+ เพิ่มสินค้า"]
      │
      ▼
[Select Product Type]
      ├─ Digital (ไฟล์ดาวน์โหลด)
      ├─ Booking (นัดหมาย)
      └─ Live (Live session)
      │
      ▼
[Product Form /dashboard/products/new]

┌─────────────────────────────────────────────────────────────────┐
│ DIGITAL PRODUCT FORM                                            │
├─────────────────────────────────────────────────────────────────┤
│ ▢ ชื่อสินค้า: [_______________]                                 │
│ ▢ รายละเอียด: [_______________]                                 │
│ ▢ ราคา: [___] บาท                                               │
│ ▢ รูปภาพ: [อัปโหลด]                                             │
│ ▢ ไฟล์ดาวน์โหลด: [อัปโหลด]                                      │
│ ▢ ส่งไฟล์ทันทีหลังอัปสลิป: [ ] (ค่าเริ่มต้น: ปิด)               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ BOOKING PRODUCT FORM                                            │
├─────────────────────────────────────────────────────────────────┤
│ ▢ ชื่อบริการ: [_______________]                                 │
│ ▢ รายละเอียด: [_______________]                                 │
│ ▢ ราคา: [___] บาท                                               │
│ ▢ รูปภาพ: [อัปโหลด]                                             │
│ ▢ ระยะเวลา: [__] นาที                                           │
│ ▢ รูปแบบ: ( ) Online ( ) Offline                                │
│ ▢ รายละเอียดสถานที่: [_______________]                          │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ LIVE PRODUCT FORM                                               │
├─────────────────────────────────────────────────────────────────┤
│ ▢ ชื่อ Live: [_______________]                                  │
│ ▢ รายละเอียด: [_______________]                                 │
│ ▢ ราคา: [___] บาท                                               │
│ ▢ รูปภาพ: [อัปโหลด]                                             │
│ ▢ วันที่/เวลา: [_______________]                                │
│ ▢ ระยะเวลา: [__] นาที                                           │
│ ▢ Platform: [Zoom/Google Meet/อื่นๆ]                            │
│ ▢ จำนวนที่นั่ง: [__]                                            │
└─────────────────────────────────────────────────────────────────┘

      │
      ▼
[Save Product]
      │
      ▼
[Redirect to /dashboard/products] ✓
```

### Acceptance Criteria - Products
- [ ] เพิ่มสินค้าได้ 3 ประเภท: digital, booking, live
- [ ] อัปโหลดรูปสินค้าได้
- [ ] อัปโหลดไฟล์ digital product ได้
- [ ] ตั้งราคาได้ (≥ 0)
- [ ] แก้ไขสินค้าได้
- [ ] ลบสินค้าได้
- [ ] Publish/Unpublish สินค้าได้
- [ ] Digital: เลือก auto-deliver หรือ manual ได้

---

## Flow 3: Buyer Purchase Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                     BUYER PURCHASE FLOW                         │
└─────────────────────────────────────────────────────────────────┘

[จาก DM/Bio Link]
      │
      ▼
[Creator Store /u/{username}]
      │
      ├─ ดู Creator Profile
      └─ ดูรายการสินค้า
      │
      ▼
[Click สินค้าที่สนใจ]
      │
      ▼
[Product Modal/Detail]
      ├─ รูปภาพ
      ├─ ชื่อ + รายละเอียด
      ├─ ราคา
      └─ ปุ่ม "ซื้อเลย"
      │
      ▼
[Click "ซื้อเลย"]
      │
      ▼
[Quick Checkout Modal]
      ├─ Email *
      ├─ ชื่อ *
      ├─ เบอร์โทร (optional)
      └─ หมายเหตุ (optional)
      │
      │ (สำหรับ Booking)
      ├─ เลือกวันที่
      └─ เลือกเวลา
      │
      ▼
[Submit] → [Create Order]
      │
      ▼
[Redirect to /checkout/{orderId}]
      │
      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    CHECKOUT PAGE                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📦 คำสั่งซื้อ #ABC123                                          │
│                                                                 │
│  สินค้า: [ชื่อสินค้า]                                           │
│  ราคา: ฿XXX                                                     │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  💳 ชำระเงินผ่าน PromptPay                                      │
│                                                                 │
│       ┌─────────────────┐                                       │
│       │   [QR CODE]     │                                       │
│       │                 │                                       │
│       │   PromptPay     │                                       │
│       └─────────────────┘                                       │
│                                                                 │
│  ชื่อบัญชี: [ชื่อ Creator]                                      │
│  จำนวน: ฿XXX                                                    │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  📷 อัปโหลดสลิป                                                 │
│                                                                 │
│       ┌─────────────────┐                                       │
│       │  [Drop Zone]    │                                       │
│       │  หรือ กดเลือก   │                                       │
│       └─────────────────┘                                       │
│                                                                 │
│       [ ส่งสลิปการโอน ]                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
      │
      ▼
[Upload Slip]
      │
      ▼
[Redirect to /success/{orderId}]
      │
      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    SUCCESS PAGE                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ✅ ส่งสลิปเรียบร้อยแล้ว                                        │
│                                                                 │
│  คำสั่งซื้อ #ABC123                                             │
│  สถานะ: รอตรวจสอบการชำระเงิน                                    │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  📧 เราจะแจ้งผลทาง email                                        │
│     your@email.com                                              │
│                                                                 │
│  ⏱️ โดยปกติใช้เวลาไม่เกิน 24 ชั่วโมง                            │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  💬 ติดต่อ Creator                                              │
│     Line: @creator                                              │
│     IG: @creator                                                │
│                                                                 │
│  [ บันทึกลิงก์นี้ไว้ติดตามสถานะ ]                               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Acceptance Criteria - Purchase
- [ ] เข้าหน้า store /u/{username} ได้
- [ ] ดูรายการสินค้าที่ publish ได้
- [ ] ดูรายละเอียดสินค้าได้
- [ ] กรอกข้อมูลผู้ซื้อได้ (email, ชื่อ)
- [ ] Booking: เลือกวันเวลาได้
- [ ] สร้าง order ได้
- [ ] ดู QR PromptPay ได้
- [ ] อัปโหลดสลิปได้
- [ ] ดูหน้า success/tracking ได้
- [ ] บันทึก/copy ลิงก์ติดตามได้

---

## Flow 4: Payment Confirmation

```
┌─────────────────────────────────────────────────────────────────┐
│                  PAYMENT CONFIRMATION FLOW                      │
└─────────────────────────────────────────────────────────────────┘

[Dashboard /dashboard]
      │
      ├─ ดู notification "มี X รายการรอยืนยัน"
      │
      ▼
[Click "คำสั่งซื้อ" หรือ notification]
      │
      ▼
[Orders List /dashboard/orders]
      │
      ├─ Tab: ทั้งหมด | รอยืนยัน | ยืนยันแล้ว | ยกเลิก
      │
      ▼
[Filter: "รอยืนยัน"]
      │
      ▼
┌─────────────────────────────────────────────────────────────────┐
│ Order #ABC123                                    🔴 รอยืนยัน    │
├─────────────────────────────────────────────────────────────────┤
│ สินค้า: E-book การตลาดออนไลน์                                   │
│ ผู้ซื้อ: somchai@email.com                                      │
│ ยอด: ฿299                                                       │
│ วันที่: 15 มี.ค. 2024 14:30                                     │
│                                              [ดูรายละเอียด]     │
└─────────────────────────────────────────────────────────────────┘
      │
      ▼
[Click "ดูรายละเอียด"]
      │
      ▼
[Order Detail /dashboard/orders/{orderId}]
      │
      ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ORDER DETAIL                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 📦 คำสั่งซื้อ #ABC123                                           │
│ สถานะ: 🔴 รอยืนยันการชำระเงิน                                   │
│                                                                 │
│ ─────────────────────────────────────                           │
│                                                                 │
│ 👤 ข้อมูลผู้ซื้อ                                                │
│    Email: somchai@email.com                                     │
│    ชื่อ: สมชาย ใจดี                                             │
│    เบอร์: 081-xxx-xxxx                                          │
│                                                                 │
│ ─────────────────────────────────────                           │
│                                                                 │
│ 📦 สินค้า                                                       │
│    E-book การตลาดออนไลน์                                        │
│    ราคา: ฿299 x 1 = ฿299                                        │
│                                                                 │
│ ─────────────────────────────────────                           │
│                                                                 │
│ 💳 หลักฐานการชำระเงิน                                           │
│                                                                 │
│    ┌─────────────────┐                                          │
│    │                 │                                          │
│    │   [SLIP IMAGE]  │  ← Click เพื่อขยาย                       │
│    │                 │                                          │
│    └─────────────────┘                                          │
│                                                                 │
│    อัปโหลดเมื่อ: 15 มี.ค. 2024 14:35                            │
│                                                                 │
│ ─────────────────────────────────────                           │
│                                                                 │
│ [ ❌ ปฏิเสธ ]              [ ✅ ยืนยันการชำระเงิน ]              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
      │
      ├─────────────────────────────────┐
      │                                 │
      ▼                                 ▼
[Click "ยืนยัน"]               [Click "ปฏิเสธ"]
      │                                 │
      ▼                                 ▼
[Confirm Modal]                [Reject Modal]
      │                                 │
      ├─ "ยืนยันว่าได้รับเงินแล้ว?"    ├─ "เหตุผล: ___"
      │                                 │
      ▼                                 ▼
[Confirm]                      [Submit]
      │                                 │
      ▼                                 ▼
[Update payment.status]        [Update payment.status]
[Update order.status]          [= 'failed']
[Create fulfillment]           [Send rejection email]
      │
      ▼
[Auto-send fulfillment based on product type]
      │
      ▼
[Done] ✓
```

### Acceptance Criteria - Confirmation
- [ ] ดูรายการ order ทั้งหมดได้
- [ ] Filter ตาม status ได้
- [ ] ดูรายละเอียด order ได้
- [ ] ดูสลิปได้ (ขยายรูปได้)
- [ ] กดยืนยันการชำระเงินได้
- [ ] กดปฏิเสธ + ใส่เหตุผลได้
- [ ] ระบบสร้าง fulfillment อัตโนมัติหลังยืนยัน
- [ ] ป้องกันกดยืนยันซ้ำ (idempotent)

---

## Flow 5: Fulfillment / Delivery

```
┌─────────────────────────────────────────────────────────────────┐
│                     FULFILLMENT FLOW                            │
└─────────────────────────────────────────────────────────────────┘

                    [After Payment Confirmed]
                              │
              ┌───────────────┼───────────────┐
              │               │               │
              ▼               ▼               ▼
         [DIGITAL]       [BOOKING]        [LIVE]


═══════════════════════════════════════════════════════════════════
                        DIGITAL PRODUCT
═══════════════════════════════════════════════════════════════════

[Payment Confirmed]
      │
      ▼
[System creates fulfillment]
      ├─ type: 'download'
      ├─ content: { file_url, max_downloads }
      └─ access_token: UUID
      │
      ▼
[Buyer visits /success/{orderId}]
      │
      ▼
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  ✅ ชำระเงินสำเร็จ!                                             │
│                                                                 │
│  คำสั่งซื้อ #ABC123                                             │
│  สินค้า: E-book การตลาดออนไลน์                                  │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  📥 ดาวน์โหลดไฟล์                                               │
│                                                                 │
│       ┌─────────────────────────────────┐                       │
│       │  📄 marketing-ebook.pdf         │                       │
│       │     2.5 MB                      │                       │
│       │     [ ⬇️ ดาวน์โหลด ]            │                       │
│       └─────────────────────────────────┘                       │
│                                                                 │
│  ⚠️ ดาวน์โหลดได้ 5 ครั้ง (เหลือ 5 ครั้ง)                        │
│  ⚠️ ลิงก์หมดอายุใน 7 วัน                                        │
│                                                                 │
│  💾 บันทึกหน้านี้ไว้!                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════
                        BOOKING PRODUCT
═══════════════════════════════════════════════════════════════════

[Payment Confirmed]
      │
      ▼
[Creator fills booking details]
      │
      ▼
[System creates fulfillment]
      ├─ type: 'booking_details'
      ├─ content: { meeting_url, meeting_date, meeting_time, notes }
      └─ access_token: UUID
      │
      ▼
[Buyer visits /success/{orderId}]
      │
      ▼
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  ✅ ยืนยันการนัดหมายแล้ว!                                       │
│                                                                 │
│  คำสั่งซื้อ #ABC123                                             │
│  บริการ: 1-on-1 Coaching Session                                │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  📅 รายละเอียดการนัดหมาย                                        │
│                                                                 │
│  วันที่: 20 มีนาคม 2024                                         │
│  เวลา: 14:00 - 15:00 น.                                         │
│  รูปแบบ: Online (Google Meet)                                   │
│                                                                 │
│  🔗 ลิงก์เข้าร่วม:                                              │
│     https://meet.google.com/xxx-yyyy-zzz                        │
│     [ 📋 Copy ]                                                 │
│                                                                 │
│  📝 หมายเหตุจาก Creator:                                        │
│     กรุณาเข้าร่วมก่อนเวลานัด 5 นาที                             │
│     เตรียมคำถามไว้ล่วงหน้า                                      │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  [ 📅 เพิ่มลง Google Calendar ]                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════
                          LIVE PRODUCT
═══════════════════════════════════════════════════════════════════

[Payment Confirmed]
      │
      ▼
[System creates fulfillment]
      ├─ type: 'live_access'
      ├─ content: { access_url, access_code, instructions }
      └─ access_token: UUID
      │
      ▼
[Buyer visits /success/{orderId}]
      │
      ▼
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  ✅ ลงทะเบียน Live สำเร็จ!                                      │
│                                                                 │
│  คำสั่งซื้อ #ABC123                                             │
│  Live: Workshop สร้าง Content ให้ปัง                            │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  📺 ข้อมูลการเข้าร่วม Live                                      │
│                                                                 │
│  วันที่: 25 มีนาคม 2024                                         │
│  เวลา: 19:00 - 21:00 น.                                         │
│  Platform: Zoom                                                 │
│                                                                 │
│  🔗 ลิงก์เข้าร่วม:                                              │
│     https://zoom.us/j/123456789                                 │
│     [ 📋 Copy ]                                                 │
│                                                                 │
│  🔑 รหัสเข้าร่วม: ABCD1234                                      │
│     [ 📋 Copy ]                                                 │
│                                                                 │
│  📝 คำแนะนำ:                                                    │
│     - เข้าร่วมก่อนเวลา 10 นาที                                  │
│     - ใช้ชื่อจริงในการเข้าร่วม                                  │
│     - เตรียม notebook ไว้จดโน้ต                                 │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  [ 📅 เพิ่มลง Google Calendar ]                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Acceptance Criteria - Fulfillment
- [ ] Digital: Buyer ดาวน์โหลดไฟล์ได้หลังยืนยัน
- [ ] Digital: จำกัดจำนวนครั้งดาวน์โหลดได้
- [ ] Digital: ตั้งวันหมดอายุได้
- [ ] Booking: Creator กรอกรายละเอียดนัดหมายได้
- [ ] Booking: Buyer เห็นรายละเอียดหลังยืนยัน
- [ ] Live: Buyer เห็น access info หลังยืนยัน
- [ ] ทุกประเภท: Copy ลิงก์ได้
- [ ] ทุกประเภท: เพิ่ม calendar event ได้ (optional)

---

## Flow 6: Auto-Reply Helper (P1)

```
┌─────────────────────────────────────────────────────────────────┐
│                    AUTO-REPLY HELPER                            │
└─────────────────────────────────────────────────────────────────┘

[Dashboard /dashboard/settings]
      │
      ▼
[Section: "ข้อความตอบกลับอัตโนมัติ"]
      │
      ▼
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  💬 ข้อความตอบกลับอัตโนมัติ                                     │
│                                                                 │
│  ใช้ข้อความเหล่านี้ตอบลูกค้าใน DM/Inbox                         │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  📝 ข้อความทั่วไป                                               │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ สวัสดีค่ะ ขอบคุณที่สนใจนะคะ ❤️                          │    │
│  │                                                         │    │
│  │ ดูรายละเอียดและสั่งซื้อได้ที่ลิงก์นี้เลย:               │    │
│  │ https://store.app/u/creator                             │    │
│  │                                                         │    │
│  │ มีอะไรสงสัยทักมาได้เลยนะคะ 🙏                           │    │
│  └─────────────────────────────────────────────────────────┘    │
│  [ 📋 Copy ]                                                    │
│                                                                 │
│  ─────────────────────────────────────                          │
│                                                                 │
│  📦 ข้อความสำหรับสินค้าเฉพาะ                                    │
│                                                                 │
│  ▼ E-book การตลาดออนไลน์                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ E-book การตลาดออนไลน์ ราคา 299 บาท                      │    │
│  │ สั่งซื้อได้ที่: https://store.app/p/abc123              │    │
│  └─────────────────────────────────────────────────────────┘    │
│  [ 📋 Copy ]                                                    │
│                                                                 │
│  ▼ 1-on-1 Coaching                                              │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ บริการ 1-on-1 Coaching ราคา 1,500 บาท/ชม.               │    │
│  │ จองเวลาได้ที่: https://store.app/p/xyz789               │    │
│  └─────────────────────────────────────────────────────────┘    │
│  [ 📋 Copy ]                                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Acceptance Criteria - Auto-Reply
- [ ] ระบบ generate ข้อความอัตโนมัติตามสินค้า
- [ ] Copy ข้อความได้
- [ ] แก้ไข template ข้อความได้

---

## Status Transitions

### Order Status
```
pending_payment ──┬──▶ pending_confirmation ──┬──▶ confirmed
                  │                           │
                  │                           └──▶ cancelled (rejected)
                  │
                  └──▶ cancelled (expired/buyer cancel)
```

### Payment Status
```
pending ──┬──▶ confirmed
          │
          └──▶ failed
```
